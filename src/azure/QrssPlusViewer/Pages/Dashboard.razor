@page "/dashboard"
@using System.Net.Http
@inject HttpClient Http

<h1>QRSS Plus</h1>

<h3>Dashboard</h3>

<button @onclick="UpdateAsync" disabled="@Tracker.IsUpdating">Update</button>

<table class="table table-bordered">
    <thead class="table-dark">
        <tr>
            <th>Grabber ID</th>
            <th>Callsign</th>
            <th>Location</th>
            <th>Image</th>
            <th>Site</th>
            <th>Active Grabs</th>
            <th>Last Grab (days)</th>
        </tr>
    </thead>
    @foreach (GrabberStatus grabber in Tracker.Grabbers)
    {
        <tr class="@(grabber.GrabUrls.Length == 0 ? "table-danger" : "")">
            <td><code>@grabber.ID</code></td>
            <td>@grabber.Callsign</td>
            <td>@grabber.Location</td>
            <td><a href="@grabber.ImageUrl">link</a></td>
            <td><a href="@grabber.SiteUrl">link</a></td>
            <td>@grabber.GrabUrls.Length</td>
            <td>@(grabber.AgeDays>1 ? Math.Round(grabber.AgeDays, 1) : "")</td>
        </tr>
    }
</table>

@code {
    private GrabberTracker Tracker = new GrabberTracker();

    private async Task UpdateAsync()
    {
        await Tracker.UpdateAsync();
    }
}
